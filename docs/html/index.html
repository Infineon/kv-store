<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Key Value Storage (kv-store)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Key Value Storage (kv-store)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Key Value Storage Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Overview</h2>
<p>This library provides a convenient way to store information as key-value pairs in non-volatile storage.</p>
<h2>Features</h2>
<ul>
<li>Supports any storage which can be modeled as a block device, including internal flash or external flash (e.g. via QSPI).</li>
<li>Allows partitioning storage by instantiating multiple instances of the library.</li>
<li>Designed to be resilient to power failures.</li>
<li>Designed to promote even wear of the storage.</li>
</ul>
<h2>Storage</h2>
<p>The utility operates on the assumption that the underlying storage is a block device which may not have the same program and erase sizes. The application is required to provide an implementation for a block device interface (<code><a class="el" href="group__group__kvstore.html#structmtb__kvstore__bd__t" title="Block device interface. ">mtb_kvstore_bd_t</a></code>) that describes the characteristics of the underlying storage and defines basic operations (read, write, erase). See <code>mtb_kvstore_init</code> for a description of the constraints that the storage must satisfy.</p>
<h2>Keys and Values</h2>
<h3>Keys</h3>
<p>Keys are ASCII strings (Null terminated). The maximum key length is defined by <code>MTB_KVSTORE_MAX_KEY_SIZE</code>. This can be overridden by the application by adding <code>DEFINES+=MTB_KVSTORE_MAX_KEY_SIZE=&lt;value&gt;</code> with the desired value to application Makefile.</p>
<h3>Values</h3>
<p>Values are arbitrary length binary data.</p>
<h2>RTOS Integration</h2>
<p>In an RTOS environment, the library can be made thread safe by defining <code>DEFINE+=CY_RTOS_AWARE</code>. This causes all API to be protected by a mutex to serialize access to underlying storage device. The kvstore library must be initialized after the RTOS kernel has started for the mutex to be initialized safely. The default timeout for the mutex is defined by <code>MTB_KVSTORE_MUTEX_TIMEOUT_MS</code> and can be overridden by specifying <code>DEFINES+=MTB_KVSTORE_MUTEX_TIMEOUT_MS=&lt;value&gt;</code> with the application Makefile.</p>
<h2>Design details</h2>
<h3>Sequential log of records</h3>
<p>The key-value pairs are stored sequentially as records. Each operation appends a new record to the next available program block. If multiple records exist for the same key, the record at the highest address takes precedence over those that came before it. In an update operation, a new record with the key and updated value is appended, overriding the previous value. In a delete operation, a new record with the key and a "deleted" flag is appended.</p>
<h3>Memory Layout</h3>
<p>The address space provided by the application is divided into two areas. At any given time, one area is designated as active and the other as swap. All key/value pair records are stored in the active area. Each time garbage collection is performed, the active and swap area designations are reversed. The first record in the active area is an area header used to identify the current active area during initialization. This means that one half of the provided storage space is available for key value storage.</p>
<h3>Record</h3>
<p>Each record contains a record header (<code>_mtb_kvstore_record_header_t</code>) that contains metadata including key/value sizes and a CRC. This is followed by the key and value data. The record is padded to the program size.</p>
<h3>RAM table</h3>
<p>A table that contains a hash for every key and the corresponding offset of the latest record for that key in storage is maintained in RAM. This table is built from storage during initialization and is updated on every subsequent operation. The key is verified by matching the key in the record in the storage. If it does not match the next entry with the same hash in the RAM table is checked. This allow for the possibility that multiple distinct keys may hash to the same value.</p>
<h3>Garbage collection</h3>
<p>When the active area does not have sufficient space remaining to perform a requested modification (add, update, delete), a garbage collection operation is performed. This process copies all of the non-obsolete records (i.e. all of those listed in the RAM table) into the swap area. The swap area is then marked as the new active area by programming the area header at the start. The former active area is erased and becomes the new swap area.</p>
<p><b>NOTE:</b> Due to the garbage collection operation, write and delete operations may consume significantly more time than typical when the active area becomes full. Hence, they must not be called from timing critical code.</p>
<h2>Dependencies</h2>
<ul>
<li><a href="https://github.com/cypresssemiconductorco/abstraction-rtos">abstraction-rtos</a> library if the <code>CY_RTOS_AWARE</code> macro is defined in the Makefile</li>
</ul>
<h2>More information</h2>
<ul>
<li><a href="http://www.cypress.com">Cypress Semiconductor, an Infineon Technologies Company</a></li>
<li><a href="https://github.com/cypresssemiconductorco">Cypress Semiconductor GitHub</a></li>
<li><a href="https://www.cypress.com/products/modustoolbox-software-environment">ModusToolbox</a> <hr/>
 Â© Cypress Semiconductor Corporation, 2021. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>Key Value Storage (kv-store)</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
